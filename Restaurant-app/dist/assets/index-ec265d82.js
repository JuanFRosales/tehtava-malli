(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const d=async(e,t={})=>{const o=await fetch(e,t);if(!o.ok)throw new Error(`Error ${o.status} occured`);return o.json()},u="https://student-restaurants.azurewebsites.net/api/v1",W="https://student-restaurants.azurewebsites.net/uploads/",z={enableHighAccuracy:!0,timeout:5e3,maximumAge:0},J=e=>{const{name:t,address:o,company:r}=e,n=document.createElement("tr"),s=document.createElement("td");s.innerText=t;const c=document.createElement("td");c.innerText=o;const a=document.createElement("td");return a.innerText=r,n.appendChild(s),n.appendChild(c),n.appendChild(a),n},G=e=>{let t=`
  <h2>Week menu</h2> <p>Click anywhere to go back</p>`;return e.days.forEach(o=>{const{date:r}=o;t+=`<div>
      <table>
      <h3>${r}</h3>
      <tr>
          <th id="course_label">Course</th>
          <th id="diet_label">Diet</th>
          <th id="price_label">Price</th>`,o.courses.forEach(n=>{const{name:s,diets:c,price:a}=n;t+=` <table>
        </tr>
              <tr>
                <td id="menu_name">${s}</td>
                <td id="diet_info">${c??" - "}</td>
                <td id="price">${a??" - "}</td>
              </tr>
              `})}),t+="</table></div>",t},K=e=>{let t=`
  <h2>Day Menu</h2> <p>Click anywhere to go back</p>
  <table>
      <tr>
        <th>Course</th>
        <th>Diet</th>
        <th>Price</th>
      </tr>`;return e.courses.forEach(o=>{const{name:r,diets:n,price:s}=o;t+=`
          <tr>
            <td>${r}</td>
            <td>${n??" - "}</td>
            <td>${s??" - "}</td>
          </tr>
          `}),t+="</table></div>",t},Q=e=>{const{name:t,address:o,city:r,postalCode:n,phone:s,company:c}=e;let a=`
  <i class="fa-solid fa-circle-xmark fa-2xl" id="close"></i>
  <h3>${t}</h3>
    <p>${c}</p>
    <p>${o} ${n} ${r}</p>
    <p>${s}</p>
    `;return a+=`<button id="weekInfo">Open week menu</button>
  <button id="dayInfo">Open day menu</button>`,a},P=e=>`
        <h3>Error</h3>
        <p>${e}</p>
        `;"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./SW/service-worker.js").then(e=>{console.log("Service Worker registered with scope:",e.scope)}).catch(e=>{console.error("Service Worker registration failed:",e)})});const L=document.querySelector("#login-form"),S=document.querySelector("#profile-form"),b=document.querySelector("#avatar-form"),D=document.querySelector("#create-form"),B=document.querySelector("#username"),I=document.querySelector("#password"),E=document.querySelector("#profile-username"),k=document.querySelector("#profile-email"),v=document.querySelector("#avatar"),T=document.querySelector("#username-target"),q=document.querySelector("#email-target"),$=document.querySelector("#avatar-target"),C=document.querySelector("#create-username"),O=document.querySelector("#create-password"),_=document.querySelector("#create-email"),V=async e=>{const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return await d(u+"/auth/login",t)},X=async e=>{const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return await d(u+"/users",t)},Y=async(e,t)=>{const o=new FormData;o.append("avatar",e);const r={method:"POST",headers:{Authorization:"Bearer "+t},body:o};return await d(u+"/users/avatar",r)},Z=async(e,t)=>{const o={method:"PUT",headers:{Authorization:"Bearer "+t,"Content-Type":"application/json"},body:JSON.stringify(e)};return await d(u+"/users",o)},H=e=>{!T||!q||!$||!k||!E||(T.innerHTML=e.username,q.innerHTML=e.email,$.src=W+e.avatar,k.value=e.email,E.value=e.username)},F=async e=>{const t={headers:{Authorization:"Bearer "+e}};return await d(u+"/users/token",t)},M=async()=>{const e=localStorage.getItem("token");if(!e)return;const t=await F(e);H(t)};M();L==null||L.addEventListener("submit",async e=>{if(e.preventDefault(),!B||!I)return;const t={username:B.value,password:I.value},o=await V(t);console.log(o),alert(o.message),localStorage.setItem("token",o.token),H(o.data)});S==null||S.addEventListener("submit",async e=>{if(e.preventDefault(),!E||!k)return;const t={username:E.value,email:k.value},o=localStorage.getItem("token");if(!o)return;const r=await Z(t,o);console.log(r),M(),alert(r.message)});b==null||b.addEventListener("submit",async e=>{if(e.preventDefault(),!(v!=null&&v.files))return;const t=v.files[0],o=localStorage.getItem("token");if(!o)return;const r=await Y(t,o);console.log(r),M(),alert(r.message)});D==null||D.addEventListener("submit",async e=>{if(e.preventDefault(),!C||!_||!O)return;const t=C.value,o=O.value,r=_.value,s=await X({username:t,password:o,email:r});alert(s.message)});const R=document.querySelector("#registration_dialog"),ee=document.getElementById("register"),te=document.getElementById("close_registration"),oe=e=>{e.preventDefault(),R.showModal()},ne=e=>{e.preventDefault(),R.close()};ee.addEventListener("click",oe);te.addEventListener("click",ne);const A=document.getElementById("login_dialog"),re=document.getElementById("login"),se=document.getElementById("close_login"),ae=e=>{e.preventDefault(),A.showModal()},ce=e=>{e.preventDefault(),A.close()};re.addEventListener("click",ae);se.addEventListener("click",ce);const j=document.getElementById("profile_dialog"),ie=document.getElementById("profile"),le=document.getElementById("close_profile"),de=e=>{e.preventDefault(),j.showModal()},ue=e=>{e.preventDefault(),j.close()};ie.addEventListener("click",de);le.addEventListener("click",ue);const i=document.getElementById("info");if(!i)throw new Error("Modal not found");const x=(e,t,o,r)=>Math.sqrt((o-e)**2+(r-t)**2),w=e=>{const t=document.querySelector("table");if(!t)throw new Error("Table not found");t.innerHTML="",e.forEach(o=>{const r=J(o);t.appendChild(r),r.addEventListener("click",async()=>{try{document.querySelectorAll(".highlight").forEach(p=>{p.classList.remove("highlight")}),r.classList.add("highlight"),i.innerHTML="";const s=await d(u+`/restaurants/daily/${o._id}/en`),c=await d(u+`/restaurants/weekly/${o._id}/en`),a=await d(u+`/restaurants/${o._id}`),l=Q(a);i.insertAdjacentHTML("beforeend",l),i.showModal();const m=document.getElementById("close");m==null||m.addEventListener("click",()=>{i.close()});const g=document.getElementById("dayInfo"),f=document.getElementById("weekInfo"),h=document.getElementById("day_menu"),y=document.getElementById("week_menu");g==null||g.addEventListener("click",()=>{const p=K(s);h.innerHTML=p,h.showModal(),i.close()}),f==null||f.addEventListener("click",()=>{const p=G(c);y.innerHTML=p,y.showModal(),i.close()}),h.addEventListener("click",()=>{h.close(),i.showModal()}),y.addEventListener("click",()=>{y.close(),i.showModal()})}catch(n){i.innerHTML=P(n.message),i.showModal()}})})},me=e=>{console.warn(`ERROR(${e.code}): ${e.message}`)},pe=async e=>{try{const t=e.coords,o=await d(u+"/restaurants");console.log(o),o.sort((a,l)=>{const m=t.latitude,g=t.longitude,f=a.location.coordinates[1],h=a.location.coordinates[0],y=x(m,g,f,h),p=l.location.coordinates[1],U=l.location.coordinates[0],N=x(m,g,p,U);return y-N}),w(o);const r=document.querySelector("#sodexo"),n=document.querySelector("#compass"),s=document.querySelector("#reset");if(!r||!n||!s)throw new Error("Button not found");r.addEventListener("click",()=>{const a=o.filter(l=>l.company==="Sodexo");console.log(a),w(a)}),n.addEventListener("click",()=>{const a=o.filter(l=>l.company==="Compass Group");console.log(a),w(a)}),s.addEventListener("click",()=>{w(o)});const c=document.getElementById("cityDropdown");c.addEventListener("change",()=>{const a=c.value,l=o.filter(m=>m.city===a);w(l)})}catch(t){i.innerHTML=P(t.message),i.showModal()}};navigator.geolocation.getCurrentPosition(pe,me,z);const ge=document.getElementById("checkbox");ge.addEventListener("change",()=>{document.body.classList.toggle("dark")});
